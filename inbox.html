<!DOCTYPE html>
<html lang="en" ng-app="inboxApp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Register</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Popper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- Font Awesome -->
    <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">

    <!-- AngularJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.2/angular.min.js" integrity="sha512-7oYXeK0OxTFxndh0erL8FsjGvrl2VMDor6fVqzlLGfwOQQqTbYsGPv4ZZ15QHfSk80doyaM0ZJdvkyDcVO7KFA==" crossorigin="anonymous"></script>

    <!-- Jquery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

    <style>
        body,html {
            height: 100%;
        }
        a,.display-4 {
            background: linear-gradient(to right, #dc2430, #7b4397);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .btn-square {
            border-radius: 0;
        }
    </style>

    <script>
        var allMails;
        var app=angular.module("inboxApp",[]);
        app.controller("inboxContr",function($scope,$http) {
            $scope.isValid=0;
            $http.get("get/checkSession.php").then(function (response) {
                $scope.result=response.data;
                if($scope.result[0]==0)
                {
                    window.location.href="index.html";
                }
                else {
                    $scope.isValid=1;
                    document.getElementById("email").innerHTML=$scope.result[1];
                    $http.get("get/checkMails.php").then(function (response) {
                        $scope.mails=response.data;
                        allMails=response.data;
                    })
                }
            })
            $scope.clearSession=function () {
                $http.get("get/clearSession.php").then(function (response) {
                    window.location.href="index.html";
                })
            }
            $scope.delete=function () {
                var checkboxes = document.getElementsByName('check');
                var mailsTBD = [];
                var j = 0;
                for(var i=0;i<checkboxes.length;i++) {
                    if(checkboxes[i].checked == true){
                        mailsTBD[j++]=checkboxes[i].className
                    }
                }
                $http.get("get/deleteMail.php",{params:{'mailsTBD':JSON.stringify(mailsTBD)}}).then(function (response) {
                    window.location.href="inbox.html";
                })
            }
            $scope.markRead=function () {
                var checkboxes = document.getElementsByName('check');
                var mailsTBD = [];
                var j = 0;
                for(var i=0;i<checkboxes.length;i++) {
                    if(checkboxes[i].checked == true){
                        mailsTBD[j++]=checkboxes[i].className
                    }
                }
                $http.get("get/markRead.php",{params:{'mailsTBD':JSON.stringify(mailsTBD)}}).then(function (response) {
                    window.location.href="inbox.html";
                })
            }
        })
        function select(type) {
            var selectMails=[];
            var j=0;
            if(type=='all') {
                checkboxes = document.getElementsByName('check');
                for(var i=0;i<checkboxes.length;i++) {
                    checkboxes[i].checked = true;
                }
            }
            if(type=='unread') {
                for(var mail of allMails){
                    if(mail.readflag==0){
                        selectMails[j++]=mail.id;
                    }
                }
                for(var i=0;i<selectMails.length;i++) {
                    var output=document.getElementsByClassName(selectMails[i])
                    for(var out of output) {
                        out.checked = true;
                    }
                }
            }
            if(type=='read') {
                for(var mail of allMails){
                    if(mail.readflag==1){
                        selectMails[j++]=mail.id;
                    }
                }
                for(var i=0;i<selectMails.length;i++) {
                    var output=document.getElementsByClassName(selectMails[i])
                    for(var out of output) {
                        out.checked = true;
                    }
                }
            }
        }
    </script>
</head>
<body style=" background:linear-gradient(to left, #7b4397, #dc2430);" ng-show="isValid==1" ng-controller="inboxContr">
<div class="container h-100" style="margin: 0px">
    <div class="row align-items-center h-100">
        <div class="col-11 mx-auto">
            <div class="card-deck h-100 justify-content-center" style="min-width: 1800px; min-height: 900px;">
                <div class="card" style="min-width: 350px; border: 0px">
                    <div class="text-center mx-auto">
                        <img src="avtar.png">
                        <h6 id="email"></h6>
                        <br/>
                        <button ng-click="clearSession()" class="btn text-white" style="background:linear-gradient(to left, #7b4397, #dc2430); width: 100px">Logout</button>
                    </div>
                    <div class="text-center">
                        <br/>
                        <button type="button" class="btn btn-square btn-primary btn-lg btn-block">Compose</button>
                    </div>
                    <div class="text-center">
                        <br/>
                        <button type="button" class="btn btn-square btn-secondary btn-lg btn-block">Inbox</button>
                    </div>
                    <div class="text-center">
                        <br/>
                        <button type="button" class="btn btn-square btn-secondary btn-lg btn-block">Trash</button>
                    </div>
                </div>
                <div class="card" style="min-width: 1350px;">
                    <nav class="navbar navbar-expand-lg navbar-light bg-light">
                        <a class="navbar-brand" href="#">Xmail</a>
                        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>

                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                            <ul class="navbar-nav mr-auto">
                                <li class="nav-item">
                                    <a class="nav-link" href="javscript:void(0)" ng-click="delete()">Delete</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="javscript:void(0)" ng-click="markRead()">Mark as Read</a>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        Select
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                        <a class="dropdown-item" href="javscript:void(0)" onclick="select('read')">Select Read</a>
                                        <a class="dropdown-item" href="javscript:void(0)" onclick="select('unread')">Select Unread</a>
                                        <div class="dropdown-divider"></div>
                                        <a class="dropdown-item" href="javscript:void(0)" onclick="select('all')">Select All</a>
                                    </div>
                                </li>
                            </ul>
                            <form class="form-inline my-2 my-lg-0">
                                <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search" ng-model="search">
                            </form>
                        </div>
                    </nav>
                    <div id="table">
                        <table class="table table-hover">
                            <tr ng-repeat="mail in mails | filter:search">
                                <td><input type="checkbox" name="check" class="{{mail.id}}"></td>
                                <td>{{mail.from}}</td>
                                <td>{{mail.subject}}</td>
                                <td>{{mail.body}}</td>
                                <td>{{mail.date}}</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>